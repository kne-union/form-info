(self.webpackChunk_kne_components_form_info=self.webpackChunk_kne_components_form_info||[]).push([[523],{1902:(e,t,r)=>{var n=r(4258),a=r(99086),o=r(50570);e.exports=function(e,t,r){return t===t?o(e,t,r):n(e,a,r)}},4258:e=>{e.exports=function(e,t,r,n){for(var a=e.length,o=r+(n?1:-1);n?o--:++o<a;)if(t(e[o],o,e))return o;return-1}},16735:e=>{e.exports=function(){}},17616:(e,t,r)=>{var n=r(59744),a=r(16735),o=r(76996),i=n&&1/o(new n([,-0]))[1]==1/0?function(e){return new n(e)}:a;e.exports=i},22164:e=>{e.exports=function(e,t,r){for(var n=-1,a=null==e?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}},25647:(e,t,r)=>{var n=r(90951);e.exports=function(e,t,r){return null==e?e:n(e,t,r)}},27342:(e,t,r)=>{var n=r(49036),a=r(63948),o=r(22164),i=r(17952),s=r(17616),u=r(76996);e.exports=function(e,t,r){var c=-1,l=a,m=e.length,d=!0,f=[],p=f;if(r)d=!1,l=o;else if(m>=200){var g=t?null:s(e);if(g)return u(g);d=!1,l=i,p=new n}else p=t?[]:f;e:for(;++c<m;){var v=e[c],h=t?t(v):v;if(v=r||0!==v?v:0,d&&h===h){for(var F=p.length;F--;)if(p[F]===h)continue e;t&&p.push(h),f.push(v)}else l(p,h,r)||(p!==f&&p.push(h),f.push(v))}return f}},33076:e=>{e.exports=function(e){return null==e}},46310:e=>{var t=Math.ceil,r=Math.max;e.exports=function(e,n,a,o){for(var i=-1,s=r(t((n-e)/(a||1)),0),u=Array(s);s--;)u[o?s:++i]=e,e+=a;return u}},50570:e=>{e.exports=function(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}},54855:(e,t,r)=>{var n=r(55949),a=r(62257),o=r(62976),i=r(2316);e.exports=function(e,t,r){if(!i(r))return!1;var s=typeof t;return!!("number"==s?a(r)&&o(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},57325:(e,t,r)=>{var n=r(20907),a=0;e.exports=function(e){var t=++a;return n(e)+t}},60094:(e,t,r)=>{var n=r(85477)();e.exports=n},63948:(e,t,r)=>{var n=r(1902);e.exports=function(e,t){return!!(null==e?0:e.length)&&n(e,t,0)>-1}},67523:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GroupList:()=>Ie,RULES:()=>ve,compileErrMsg:()=>j,computedFieldValueFromFormData:()=>Oe,computedFormDataFormState:()=>Ce,default:()=>Fe,filterEmpty:()=>L,findField:()=>De,formUtils:()=>Te,interceptors:()=>ue,isEmpty:()=>T,isNotEmpty:()=>O,matchFields:()=>Pe,preset:()=>he,stateToError:()=>Ne,stateToIsPass:()=>Re,useField:()=>Ae,useFormApi:()=>B,useFormContext:()=>B,useGroup:()=>xe,useReset:()=>Ve,useSubmit:()=>Me});var n=r(14888),a=r.n(n),o=r(27497),i=r.n(o),s=r(18710),u=r.n(s),c=r(92679),l=r.n(c),m=r(33227),d=r.n(m),f=r(33076),p=r.n(f),g=r(71406),v=r.n(g),h=r(9211),F=r.n(h),y=r(73075),b=r.n(y),x=r(25647),E=r.n(x),I=r(94922),S=r.n(I);const w=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})};r(98171);var A=r(78678),V=r(20775),M=r.n(V),R=r(60094),N=r.n(R),C=r(57325),D=r.n(C);function P(e,t,r,n){var a=this,o=(0,I.useRef)(null),i=(0,I.useRef)(0),s=(0,I.useRef)(0),u=(0,I.useRef)(null),c=(0,I.useRef)([]),l=(0,I.useRef)(),m=(0,I.useRef)(),d=(0,I.useRef)(e),f=(0,I.useRef)(!0);d.current=e;var p="undefined"!=typeof window,g=!t&&0!==t&&p;if("function"!=typeof e)throw new TypeError("Expected a function");t=+t||0;var v=!!(r=r||{}).leading,h=!("trailing"in r)||!!r.trailing,F="maxWait"in r,y="debounceOnServer"in r&&!!r.debounceOnServer,b=F?Math.max(+r.maxWait||0,t):null;(0,I.useEffect)(function(){return f.current=!0,function(){f.current=!1}},[]);var x=(0,I.useMemo)(function(){var e=function(e){var t=c.current,r=l.current;return c.current=l.current=null,i.current=e,s.current=s.current||e,m.current=d.current.apply(r,t)},r=function(e,t){g&&cancelAnimationFrame(u.current),u.current=g?requestAnimationFrame(e):setTimeout(e,t)},x=function(e){if(!f.current)return!1;var r=e-o.current;return!o.current||r>=t||r<0||F&&e-i.current>=b},E=function(t){return u.current=null,h&&c.current?e(t):(c.current=l.current=null,m.current)},I=function e(){var n=Date.now();if(v&&s.current===i.current&&S(),x(n))return E(n);if(f.current){var a=t-(n-o.current),u=F?Math.min(a,b-(n-i.current)):a;r(e,u)}},S=function(){n&&n({})},w=function(){if(p||y){var n=Date.now(),s=x(n);if(c.current=[].slice.call(arguments),l.current=a,o.current=n,s){if(!u.current&&f.current)return i.current=o.current,r(I,t),v?e(o.current):m.current;if(F)return r(I,t),e(o.current)}return u.current||r(I,t),m.current}};return w.cancel=function(){var e=u.current;e&&(g?cancelAnimationFrame(u.current):clearTimeout(u.current)),i.current=0,c.current=o.current=l.current=u.current=null,e&&n&&n({})},w.isPending=function(){return!!u.current},w.flush=function(){return u.current?E(Date.now()):m.current},w},[v,F,t,b,h,g,p,y,n]);return x}const O=e=>{if(a()(e)){const t=i()(e);return t.length>0&&t.some(e=>!!e)}return u()(e)?e.length>0:"number"===typeof e?!isNaN(e):!(void 0===e||null===e||""===e||0===e.length)},T=e=>!O(e),L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u()(e))return e.map(e=>L(e)).filter(O);if(a()(e)){const t={};return Object.keys(e).forEach(r=>{const n=L(e[r]);O(n)&&(t[r]=n)}),t}return e},j=(e,t)=>"string"===typeof e?e.replace("%s",t):e(t);var k;const _="PRE_INIT",G="INIT",U="INIT",z="PENDING",Q="PASS",Z="ERROR";class H{constructor(e){let{id:t,name:r,associations:n,formInterceptor:a,options:o}=e;this.id=t,this.name=r,this.formInterceptor=a,this.groupName=null,this.groupIndex=null,this.state=_,this.fieldRef=null,this.associations={fields:d()(n,"fields",[]).filter(e=>!!e.name),callback:d()(n,"callback",()=>{})},this.validate={status:U},this.value=void 0,this.options=Object.assign({},o)}get isReady(){return this.state===G}get isPass(){return this.validate.status===Q}setInfo(e){let{groupName:t,groupIndex:r,label:n,rule:a,interceptor:o,noTrim:i,fieldRef:s,errMsg:u}=e;return this.groupName=t,this.groupIndex=r,this.label=n,this.rule=a,this.interceptor=o,this.noTrim=i,this.fieldRef=s,this.errMsg=u,this.state=G,this.path=H.getFieldValuePath(this),this}getValueFromFormData(e){return H.computedFieldValueFromFormData(this,e)}setFieldValue(e){return this.setValue(this.formInterceptor.input({value:e,interceptor:this.interceptor})),this}getFieldValue(){return this.formInterceptor.output({value:this.value,interceptor:this.interceptor})}getErrState(){return this.validate.status===Q?1:this.validate.status===Z?2:this.validate.status===z?3:0}getErrMsg(){return j(this.errMsg||this.validate.msg||"",this.label)}setValidateStatus(e){let{status:t,msg:r="",validateData:n}=e;return this.validate={status:(e=>1===e?Q:2===e?Z:U)(t),msg:r,validateData:Object.assign({},this.validate.validateData,n)},this}async runValidate(e,t){const r=await(async e=>{let{field:t,value:r,formRules:n,getFormData:a}=e;if("function"===typeof t.rule)return await t.rule(r,Object.assign({},{data:a()},{field:t}));if("object"===typeof t.rule&&t.rule instanceof RegExp)return{result:t.rule.test(r),errMsg:""};const o={};if("string"===typeof t.rule){const e=t.rule.split(" ").filter(e=>e.length>0);for(let i of e){let[e,...s]=i.split("-");const u=n[e.toUpperCase()];if("function"===typeof u){if("REQ"!==i&&!0!==n.REQ(r,...s,Object.assign({},{data:a()},{field:t})).result)return{result:!0,errMsg:"",data:o};const c=await u(r,...s,Object.assign({},{data:a()},{field:t}));if(Object.assign(o,{[e.toUpperCase()]:c.data}),!0!==c.result)return{result:!1,errMsg:c.errMsg,data:o}}else console.error("\u6821\u9a8c\u89c4\u5219".concat(i,"\u4e0d\u5728\u5f53\u524dform\u7684rules\u91cc\u9762\uff0c\u8bf7\u786e\u8ba4").concat(t.name,"\u7684\u6821\u9a8c\u89c4\u5219").concat(t.rule,"\u662f\u5426\u6b63\u786e"))}}return{result:!0,errMsg:"",data:o}})({field:this.clone(),value:this.value,formRules:e,getFormData:t});return this.validate={status:!0===r.result?Q:Z,msg:r.errMsg,validateData:Object.assign({},r.data)},this}setValue(e){return this.value===e||(this.value=e,this.validate={status:U}),this}deleteValue(){return this.setValue(void 0),this}clone(){return v()(this)}}k=H,H.stateToError=b()(e=>Array.from(e.values()).filter(e=>d()(e,"validate.status")===Z).map(e=>Object.assign({},e.validate,{name:e.name,label:e.label,groupName:e.groupName,fieldRef:e.fieldRef,groupIndex:e.groupIndex,errMsg:e.getErrMsg()}))),H.findField=(e,t)=>t.id?e.get(t.id):t.groupName?Array.from(e.values()).find(e=>e.name===t.name&&e.groupName===t.groupName&&e.groupIndex===t.groupIndex):Array.from(e.values()).find(e=>e.name===t.name),H.matchField=(e,t)=>Object.keys(t).filter(e=>!p()(t[e])).every(r=>e[r]===t[r]),H.matchFields=(e,t)=>{if(!t.groupName){const r=k.findField(e,t);return r?[r]:[]}return Array.from(e.values()).filter(e=>k.matchField(e,t))},H.matchAssociationFields=(e,t)=>Array.from(e.values()).filter(e=>e.id!==t.id&&(!(!e.associations.fields&&e.associations.fields.length>0)&&e.associations.fields.some(e=>k.matchField(t,e)))),H.getFieldValuePath=e=>e.groupName&&!p()(e.groupIndex)&&l()(e.groupName.split("."))===e.name?"".concat(e.groupName,'["').concat(e.groupIndex,'"]'):e.groupName&&!p()(e.groupIndex)?"".concat(e.groupName,'["').concat(e.groupIndex,'"].').concat(e.name):e.name,H.computedFormDataFormState=b()(e=>F()(Array.from(e.values()),(e,t)=>{if(!t.name)return;const r=t.getFieldValue();E()(e,k.getFieldValuePath(t),r)},{})),H.computedFieldValueFromFormData=b()((e,t)=>d()(t,k.getFieldValuePath(e))),H.stateToIsPass=e=>Array.from(e.values()).every(e=>e.isPass);const W=(0,I.createContext)({}),{Provider:$,Consumer:q}=W,B=()=>{const{openApiRef:e}=(0,I.useContext)(W);return(0,I.useMemo)(()=>({get formData(){return e.current.data},get formState(){return e.current.formState},get openApi(){return e.current},get isPass(){return e.current.isPass},get errors(){return e.current.errors},get emitter(){return e.current.emitter}}),[e])},J=e=>{let{openApi:t,children:r}=e;const n=(0,I.useRef)(t);return n.current=t,S().createElement($,{value:{openApiRef:n}},r)},K=(0,I.createContext)({}),{Provider:X,Consumer:Y}=K,ee=()=>(0,I.useContext)(K);function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},te.apply(null,arguments)}function re(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}const ne=e=>({getField:(t,r)=>{let n=e.current.getFormState().get(t);if(n)return r(n.clone())},setFieldInfo:t=>e.current.setFormState(e=>{if(!e.get(t.id))return e;const r=new Map(e);return r.set(t.id,t),r})}),ae=["id","defaultValue"],oe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Promise(e=>setTimeout(()=>{e(...t)},0))},ie=(e,t)=>"".concat(e||"root","@").concat(t),se=e=>{let{children:t}=e;const r=ee(),n=(0,I.useRef)(r);return n.current=r,(0,I.useEffect)(()=>{const{emitter:e,setFormIsMount:t}=n.current;return t(!0),e.emit("form:mount"),()=>{e.emit("form:unmount")}},[]),(0,I.useEffect)(()=>{const{emitter:e}=n.current;return e.addListener("form:field:add",(e=>t=>{let{id:r,name:n,associations:a}=t;const{setFormState:o,interceptor:i,emitter:s}=e.current;o(e=>{const t=new Map(e);return t.set(r,new H({id:r,name:n,formInterceptor:i,associations:a})),t}),s.emit("form-field:mount:".concat(r))})(n)),e.addListener("form:field:change",(e=>async t=>{let{id:r,defaultValue:n}=t,a=re(t,ae);const{setFormState:o,initFormData:i,emitter:s}=e.current,{getField:u}=ne(e);u(r,async e=>{e.setInfo(a),(()=>{if(void 0!==e.value)return;const t=e.getValueFromFormData(i);t?e.setFieldValue(t):void 0!==n&&e.setFieldValue(n)})(),o(t=>{const n=new Map(t);return n.set(r,e),n}),void 0!==e.value&&s.emit("form-field:input:".concat(e.id),{value:e.value}),s.emit("form:field:ready",e)})})(n)),e.addListener("form:field:remove",(e=>t=>{let{id:r}=t;const{setFormState:n}=e.current;n(e=>{const t=new Map(e);return t.delete(r),t})})(n)),e.addListener("form:validate",(e=>()=>{const{formState:t,emitter:r}=e.current;Array.from(t.values()).forEach(e=>{r.emit("form-field:validate:".concat(e.id))})})(n)),e.addListener("form:reset",(e=>()=>{const{getFormState:t,emitter:r}=e.current;Array.from(t().values()).forEach(e=>{r.emit("form-field:input:".concat(e.id),{value:void 0})})})(n)),e.addListener("form:set-data",(e=>async t=>{let{data:r,runValidate:n=!0}=t;const{setFormState:a,emitter:o}=e.current;a(e=>{const t=new Map;return Array.from(e.values()).forEach(e=>{if(!e.isReady)return;const n=e.clone();n.setFieldValue(n.getValueFromFormData(r)),t.set(e.id,n),o.emit("form-field:input:".concat(e.id),{value:n.value})}),t}),await oe(),n&&Array.from(e.current.formState.values()).forEach(e=>{o.emit("form-field:validate:".concat(e.id))})})(n)),e.addListener("form:set-fields",(e=>async t=>{let{data:r,runValidate:n=!0}=t;const{emitter:a,getFormState:o}=e.current;Array.isArray(r)||(r=[r]);const{setFieldInfo:i,getField:s}=ne(e),u=[];r.forEach(e=>{const{name:t,groupName:r,groupIndex:n,value:c,validate:l}=Object.assign({},e),m=H.matchFields(o(),{name:t,groupName:r,groupIndex:n});m&&m.length>0&&m.forEach(r=>{r.isReady&&(e.hasOwnProperty("value")&&a.emit("form-field:input:".concat(r.id),{value:p()(t)?d()(c,r.name):c}),s(r.id,e=>{l?e.setValidateStatus(l):u.push(e.id),i(e)}))})}),n&&u.forEach(e=>{a.emit("form-field:validate:".concat(e))})})(n)),e.addListener("form:submit",(e=>async function(){const{task:t,emitter:r,noFilter:n,onError:a,onPrevSubmit:o,onSubmit:i,onComplete:s}=e.current;e.current.getFormState().forEach(e=>{r.emit("form-field:validate:".concat(e.id))});let u=[],c=!1,l={};for(var m=arguments.length,d=new Array(m),f=0;f<m;f++)d[f]=arguments[f];try{if(await t.target,c=H.stateToIsPass(e.current.getFormState()),c){const t=H.computedFormDataFormState(e.current.getFormState());if(l=!0===n?t:L(t),r.emit("form:prev-submit",l,...d),o&&!1===await o(l,...d))return r.emit("form:prev-submit:error"),!1;i&&await i(l,...d),r.emit("form:submit:success",l,...d)}else u=H.stateToError(e.current.getFormState()),r.emit("form:submit:error",u),a&&await a(u,...d)}catch(p){console.error(p),r.emit("form:error",u,...d,p),a&&a(u,...d,p)}r.emit("form:submit:complete",{formData:l,isPass:c,errors:u}),s&&s({formData:l,isPass:c,errors:u})})(n)),e.addListener("form-group:change",(e=>t=>{let{parentId:r,name:n,list:a}=t;const{setGroup:o}=e.current;o(e=>{const t=Object.assign({},e);return t[ie(r,n)]=a.slice(0),t})})(n)),e.addListener("form-group:remove",(e=>t=>{let{parentId:r,name:n}=t;const{setGroup:a}=e.current;a(e=>{const t=Object.assign({},e),a=ie(r,n);if(t[a])return delete t[a],t})})(n)),()=>{e.removeAllListeners()}},[]),t},ue={input:[],output:[]};ue.input.use=(e,t)=>ue.input.push({name:e,exec:t}),ue.output.use=(e,t)=>ue.output.push({name:e,exec:t});const ce=ue,le=(e,t,r)=>{Array.isArray(r)||(r=[r]);const n=ce[t].concat(d()(e,t,[])),a=r.map(e=>n.find(t=>{let{name:r}=t;return r===e})).filter(e=>!!e);return"input"===t&&a.reverse(),0===a.length?e=>e:w(...a.map(e=>{let{exec:t}=e;return t}))},me="PENDING",de="COMPLETE";class fe{constructor(e){let{id:t,runner:r}=e;this.id=t,this.isCancel=!1,this.target=Promise.race([Promise.resolve(r()),new Promise(e=>{this.resolve=e})])}cancel(){this.isCancel||(this.isCancel=!0,this.resolve(...arguments))}}class pe{constructor(e){let{onChange:t}=e;this.list=new Map,this.onChange=t}get isComplete(){return 0===this.list.size}async append(e,t){const r=new fe({id:e,runner:t});return this.expire(e),this.list.set(e,r),r.target.then(()=>{this.list.delete(e),this.onChange()}),this.onChange(),r.target}expire(e){const t=this.list.get(e);return t&&(t.cancel(),this.list.delete(e)),this}}const ge=()=>{const[e,t]=(0,I.useState)(de),r=(0,I.useRef)(new pe({onChange(){t(this.isComplete?de:me)}}));return{state:e,append:(e,t)=>r.current.append(e,t),expire:e=>r.current.expire(e),get target(){return oe().then(()=>Promise.all(Array.from(r.current.list.values()).map(e=>e.target))).then(oe)}}},ve={REQ:function(e){return{result:O(e),errMsg:""}},TEL:function(e){return{result:/^1[0-9]{10}$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7"}},EMAIL:function(e){return{result:/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e),errMsg:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1"}},LEN:function(e,t,r){return e=e.toString(),r===t&&e.length!==Number(r)?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u7b49\u4e8e".concat(r)}:e.length<t?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u5927\u4e8e".concat(t)}:r&&e.length>r?{result:!1,errMsg:"%s\u957f\u5ea6\u5fc5\u987b\u5c0f\u4e8e".concat(r)}:{result:!0}}},he=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(ve,e)},Fe=(0,I.forwardRef)((e,t)=>{let{data:r,rules:n,interceptors:a,debug:o,noFilter:i,onPrevSubmit:s,onSubmit:u,onError:c,onFormDataChange:l,children:m}=e;const[d,f]=(0,I.useState)(new Map),p=(0,I.useRef)(d),[g,v]=(0,I.useState)(!1),h=ge(),F=M()({debug:o,name:"react-form3"}),{group:y,setGroup:b}=(()=>{const[e,t]=(0,I.useState)(new Map);return{group:e,setGroup:t}})(),x=(e=>{let{formStateRef:t,emitter:r}=e;return(0,I.useMemo)(()=>({emitter:r,submit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.emit("form:submit",t)},get isPass(){return H.stateToIsPass(t.current)},get formState(){return new Map(t.current)},get data(){return H.computedFormDataFormState(t.current)},set data(e){r.emit("form:set-data",{data:e})},get errors(){return H.stateToError(t.current)},reset(){r.emit("form:reset")},onReady(e){r.addListener("form:mount",()=>{e&&e()})},onDestroy(e){r.addListener("form:unmount",()=>{e&&e()})},validateField(e){let{name:n,groupName:a,groupIndex:o}=e;const i=H.findField(t.current,{name:n,groupName:a,groupIndex:o});i&&r.emit("form-field:validate:".concat(i.id))},validateAll(){r.emit("form:validate")},setFormData:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r.emit("form:set-data",{data:e,runValidate:t})},getFormData:()=>H.computedFormDataFormState(t.current),getField(e){let{name:r,groupName:n,groupIndex:a}=e;return H.findField(t.current,{name:r,groupName:n,groupIndex:a})},getFields(e){let{name:r,groupName:n,groupIndex:a}=e;return H.matchFields(t.current,{name:r,groupName:n,groupIndex:a})},setFieldValidate(e){let{name:t,validate:n,groupName:a,groupIndex:o}=e;n?r.emit("form:set-fields",{data:{name:t,groupName:a,groupIndex:o,validate:n}}):console.error("\u5fc5\u987b\u8bbe\u7f6evalidate\u53c2\u6570")},setField(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFields(e,t){r.emit("form:set-fields",Object.assign({},t,{data:e}))},setFieldValue(e,t,n){let{name:a,groupName:o,groupIndex:i,validate:s}=e;r.emit("form:set-fields",Object.assign({},n,{data:{name:a,groupName:o,groupIndex:i,value:t,validate:s}}))}}),[t,r])})({emitter:F,formStateRef:p}),E=(e=>{let{interceptors:t}=e;return{input:(0,A.A)(e=>{let{value:r,interceptor:n}=e;return le(t,"input",n)(r)}),output:(0,A.A)(e=>{let{value:r,interceptor:n}=e;return le(t,"output",n)(r)})}})({interceptors:a});return(0,I.useImperativeHandle)(t,()=>x,[x]),S().createElement(X,{value:{emitter:F,openApi:x,task:h,formState:d,getFormState:()=>p.current,setFormState(e){const t="function"===typeof e?e(p.current):e;return p.current=t,f(t),t},formIsMount:g,setFormIsMount:v,group:y,setGroup:b,initFormData:Object.assign({},r),rules:Object.assign({},ve,n),interceptor:E,debug:o,noFilter:i,onPrevSubmit:s,onSubmit:u,onError:c,onFormDataChange:l}},S().createElement(J,{openApi:x},S().createElement(se,null,m)))}),ye=(0,I.createContext)({id:"root"}),{Provider:be}=ye,xe=()=>(0,I.useContext)(ye),Ee=e=>{let{id:t,name:r,children:n,defaultValue:a}=e;const{group:o}=ee(),{id:i,index:s,name:u}=xe(),c=(0,I.useMemo)(()=>d()(o,ie(i,r),[]).findIndex(e=>e.id===t),[t,i,o,r]),l=(0,I.useMemo)(()=>c>-1&&u?"".concat(u,"[").concat(s,"].").concat(r):r,[u,r,c,s]);return S().createElement(be,{value:{id:t,name:l,group:o,index:c,defaultValue:a}},n({id:t,name:l,group:o,index:c}))},Ie=(0,I.forwardRef)((e,t)=>{let{name:r,defaultLength:n=1,empty:a,reverseOrder:o=!0,children:i}=e;const[s,u]=(0,I.useState)([]),c=(0,I.useRef)(s);c.current=s;const{initFormData:l,emitter:m}=ee(),{id:f,name:p,index:g}=xe(),v=(0,I.useMemo)(()=>g>-1&&p?"".concat(p,"[").concat(g,"]"):"",[p,g]),h=v?"".concat(v,".").concat(r):r,F=e=>Object.assign({},e,{id:f?D()(f+"-"):D()()}),y=(0,A.A)(e=>{let{groupName:t,name:r}=e;const a=e=>{const t=Number.isInteger(n)&&n>0&&!(Array.isArray(e)&&e.length>=n)?N()(0,n).map(e=>c.current[e]||F()):Array.isArray(e)?e.map((e,t)=>c.current[t]||F({defaultValue:e})):[];u(t)};a(d()(l,t?"".concat(t,".").concat(r):r));const o=m.addListener("form:set-data",e=>{let{data:n}=e;a(d()(n,t?"".concat(t,".").concat(r):r))});return()=>{o.remove()}});(0,I.useEffect)(()=>{m.emit("form-group:change",{parentId:f,name:r,list:s})},[s,f,r,m]),(0,I.useEffect)(()=>()=>{m.emit("form-group:remove",{parentId:f,name:r})},[f,r]),(0,I.useEffect)(()=>y({groupName:v,name:r}),[v,r]);const b=(0,A.A)(e=>{const{isUnshift:t,defaultValue:r}=Object.assign({isUnshift:!1},e);u(e=>{if(0===e.length)return[{id:D()(f)}];const n=e.slice(0);return n[t?"unshift":"push"](F({defaultValue:r})),n})}),x=(0,A.A)(e=>{u(t=>{const r=t.findIndex(t=>t.id===e),n=d()(l,h);Array.isArray(n)&&n.splice(r,1);const a=t.slice(0);return a.splice(r,1),a})});return(0,I.useImperativeHandle)(t,()=>({onAdd:b,onRemove:x})),0===s.length?a:(o?s.slice(0).reverse():s).map(e=>{let{id:t,defaultValue:n}=e;return S().createElement(Ee,{key:t,id:t,name:r,defaultValue:n},e=>{let{index:r}=e;return i({id:t,index:r,length:s.length,onAdd:b,onRemove:()=>x(t)})})})}),Se=(e,t)=>{if((e=>window.Event&&(e instanceof window.Event||d()(e,"nativeEvent")instanceof window.Event||"function"===typeof d()(e,"preventDefault")))(e)){if(void 0===t)switch(e.target.type){case"checkbox":case"radio":t=e.target.checked;break;default:t=e.target.value}}else t=e;return t},we=["name","rule","label","interceptor","associations","noTrim","debounce","onChange","defaultValue","errMsg"],Ae=e=>{let{name:t,rule:r,label:n,interceptor:a,associations:o,noTrim:i,debounce:s=0,onChange:u,defaultValue:c,errMsg:l}=e,m=re(e,we);const f=(0,I.useId)(),{index:p,name:g,defaultValue:v}=xe(),{formState:h}=ee(),[F,y]=(0,I.useState)({}),b=(e=>{let{name:t,rule:r,label:n,interceptor:a,associations:o,noTrim:i,defaultValue:s,id:u,groupName:c,groupIndex:l,errMsg:m}=e;const[d,f]=(0,I.useState)(!1),p=(0,I.useRef)(null),{formIsMount:g,emitter:v}=ee(),h=(0,I.useRef)(o);return(0,I.useEffect)(()=>{let e=!1;return g&&(e=!0,f(!0),v.emit("form:field:add",{name:t,associations:h.current,id:u})),()=>{e&&v.emit("form:field:remove",{id:u})}},[g,v,t,u]),(0,I.useEffect)(()=>{d&&-1!==l&&v.emit("form:field:change",{name:t,rule:r,label:n,interceptor:a,noTrim:i,id:u,groupName:c,groupIndex:l,defaultValue:s,fieldRef:p,errMsg:m})},[d,v,t,r,n,a,i,u,c,l,s,p,m]),p})({name:t,rule:r,label:n,interceptor:a,associations:{fields:d()(o,"fields",[]),callback:function(){y(Object.assign({},null==o?void 0:o.callback(...arguments)))}},noTrim:i,defaultValue:d()(v,t)||c,id:f,groupName:g,groupIndex:p,errMsg:l}),{validate:x,isValueChanged:E,dataChange:S,value:w}=(e=>{let{id:t,defaultValue:r,onChange:n,time:a}=e;const o=ee(),{formIsMount:i}=o,s=(0,I.useRef)(o);s.current=o;const[u,c]=(0,I.useState)(!1),[l,m]=(0,I.useState)(r);(0,I.useEffect)(()=>{if(!i)return;const{getField:e,setFieldInfo:r}=ne(s),{emitter:n}=s.current,a=[n.addListener("form-field:input:".concat(t),a=>{let{value:o}=a;m(o),c(!0),e(t,async e=>{e.setValue(o),r(e),void 0!==e.getFieldValue()&&(n.emit("form:field:set-value",{id:t,value:e.getFieldValue(),path:e.path}),n.emit("form-field:associations:".concat(t)))})}),n.addListener("form-field:format:".concat(t),r=>{let{format:a}=r;e(t,e=>{const r=a(e.value);e.value!==r&&n.emit("form-field:input:".concat(t),{value:r})})}),n.addListener("form-field:validate:".concat(t),async()=>{const{rules:a,task:o}=s.current;await o.append(t,async()=>{await e(t,async e=>{e.setValidateStatus({status:z}),r(e)}),await e(t,e=>{!0!==e.noTrim&&"string"===typeof e.value&&n.emit("form-field:format:".concat(t),{format:e=>e.trim()})}),await e(t,async e=>{await e.runValidate(a,()=>H.computedFormDataFormState(s.current.getFormState())),r(e),n.emit("form-field:validate:complete:".concat(t),{validate:e.validate})})})}),n.addListener("form-field:associations:".concat(t),async()=>{const{getFormState:r,openApi:a}=s.current;e(t,e=>{H.matchAssociationFields(r(),e).forEach(t=>{var r;n.emit("form-field:associations:callback",{target:t,origin:e}),null==(r=t.associations)||r.callback({target:t,origin:e,openApi:a})})})})];return()=>{a.forEach(e=>{e.remove()})}},[i]);const d=(0,A.A)(function(){n&&n(...arguments);const{emitter:e}=s.current,r=Se(...arguments);e.emit("form-field:input:".concat(t),{value:r})}),f=(0,A.A)(()=>{const{emitter:e}=s.current;e.emit("form-field:validate:".concat(t))}),p=P(f,a),g=p.cancel;return(0,I.useEffect)(()=>{const{emitter:e}=s.current,t=e.addListener("form:reset",g);return()=>{t&&t.remove()}},[g]),{isValueChanged:u,value:l,dataChange:d,validate:a?p:f}})({id:f,time:s,onChange:u}),V=h.get(f),M=te({},m,{id:f,name:t,label:n,value:w,fieldRef:b,formData:H.computedFormDataFormState(h),formState:h,rule:r,groupName:g,groupIndex:p,onChange:S,isValueChanged:E,triggerValidate:x,associationOptions:F});return V?Object.assign({},M,{value:w,errState:V.getErrState(),errMsg:V.getErrMsg()}):M},Ve=()=>{const{emitter:e}=ee();return{onClick:(0,I.useCallback)(()=>{e.emit("form:reset")},[e])}},Me=e=>{const[t,r]=(0,I.useState)(!1),{isPass:n,emitter:a}=ee(),{onClick:o}=Object.assign({},e);return(0,I.useEffect)(()=>{const e=a.addListener("form:submit:complete",()=>{r(!1)});return()=>{e&&e.remove()}},[a]),{isLoading:t,isPass:n,onClick:(0,I.useCallback)(async function(){r(!0);try{await oe();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=o&&await o(...t);a.emit("form:submit",r||t)}catch(i){console.error(i)}},[a,r])}},Re=H.stateToIsPass,Ne=H.stateToError,Ce=H.computedFormDataFormState,De=H.findField,Pe=H.matchFields,Oe=H.computedFieldValueFromFormData,Te={isNotEmpty:O,isEmpty:T,filterEmpty:L,compileErrMsg:j,stateToIsPass:Re,stateToError:Ne,computedFormDataFormState:Ce,findField:De,matchFields:Pe,computedFieldValueFromFormData:Oe}},68965:(e,t,r)=>{var n=r(2899),a=1/0;e.exports=function(e){return e?(e=n(e))===a||e===-1/0?17976931348623157e292*(e<0?-1:1):e===e?e:0:0===e?e:0}},85477:(e,t,r)=>{var n=r(46310),a=r(54855),o=r(68965);e.exports=function(e){return function(t,r,i){return i&&"number"!=typeof i&&a(t,r,i)&&(r=i=void 0),t=o(t),void 0===r?(r=t,t=0):r=o(r),i=void 0===i?t<r?1:-1:o(i),n(t,r,i,e)}}},90951:(e,t,r)=>{var n=r(86654),a=r(67574),o=r(62976),i=r(2316),s=r(12408);e.exports=function(e,t,r,u){if(!i(e))return e;for(var c=-1,l=(t=a(t,e)).length,m=l-1,d=e;null!=d&&++c<l;){var f=s(t[c]),p=r;if("__proto__"===f||"constructor"===f||"prototype"===f)return e;if(c!=m){var g=d[f];void 0===(p=u?u(g,f,d):void 0)&&(p=i(g)?g:o(t[c+1])?[]:{})}n(d,f,p),d=d[f]}return e}},92679:e=>{e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},98171:(e,t,r)=>{var n=r(52486),a=r(27342);e.exports=function(e,t){return e&&e.length?a(e,n(t,2)):[]}},99086:e=>{e.exports=function(e){return e!==e}}}]);
//# sourceMappingURL=523.1a7b70e9.chunk.js.map